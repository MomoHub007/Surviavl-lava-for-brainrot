local Fluent = loadstring(game:HttpGet("https://github.com/dawid-scripts/Fluent/releases/latest/download/main.lua"))()
local SaveManager = loadstring(game:HttpGet("https://raw.githubusercontent.com/dawid-scripts/Fluent/master/Addons/SaveManager.lua"))()
local InterfaceManager = loadstring(game:HttpGet("https://raw.githubusercontent.com/dawid-scripts/Fluent/master/Addons/InterfaceManager.lua"))()

local Window = Fluent:CreateWindow({
    Title = "MoMoHub V.AutoFuse",
    SubTitle = "Survival lava for Brainrot",
    TabWidth = 160,
    Size = UDim2.fromOffset(580, 540),
    Acrylic = true,
    Theme = "Dark",
    MinimizeKey = Enum.KeyCode.LeftControl
})

local Tabs = {
    Main = Window:AddTab({ Title = "Main", Icon = "home" }),
    Brainrot = Window:AddTab({ Title = "Brainrot", Icon = "zap" }),
    Place = Window:AddTab({ Title = "Place", Icon = "package" }),
    Sell = Window:AddTab({ Title = "Sell Brainrot", Icon = "coins" }),
    FuseMachine = Window:AddTab({ Title = "FuseMachine", Icon = "cpu" }),
    Rebirth = Window:AddTab({ Title = "Rebirth", Icon = "refresh-cw" }),
    Teleport = Window:AddTab({ Title = "Teleport", Icon = "map-pin" }),
    Discord = Window:AddTab({ Title = "Discord", Icon = "message-circle" }),
    Settings = Window:AddTab({ Title = "Settings", Icon = "settings" })
}

-- ==========================================
-- Variables & Services
-- ==========================================
local Players = game:GetService("Players")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local vim = game:GetService("VirtualInputManager")
local player = Players.LocalPlayer

local gameFolder = workspace:WaitForChild("GameFolder", 10)
local brainrotsFolder = gameFolder and gameFolder:WaitForChild("Brainrots", 5)
local plotsFolder = gameFolder and gameFolder:WaitForChild("Plots", 5)
local raritiesFolder = gameFolder and gameFolder:WaitForChild("Rarities", 5)
local upgradeEvent = ReplicatedStorage:WaitForChild("Events"):WaitForChild("Upgrade")
local sellEvent = ReplicatedStorage:WaitForChild("Events"):WaitForChild("SellDialogue")

-- States
local AutoClaimEnabled = false
local ClaimDelay = 0.5
local AutoUpgradeBrainrotEnabled = false
local AutoUpgradePlotEnabled = false
local AutoSpeedEnabled = false
local SpeedUpgradeAmount = 10

local AutoCollectEnabled = false
local SelectedCollectMutations = {["Normal"] = true}
local SelectedCollectRarities = {["Common"] = true}

local AutoPlaceEnabled = false
local SelectedPlaceMutations = {["Normal"] = true}
local SelectedPlaceRarities = {["Common"] = true}

local AutoSellEnabled = false
local SelectedSellMutations = {["Normal"] = true}
local SelectedSellRarities = {["Common"] = true}

-- States for Rebirth
local AutoCollectRequestEnabled = false
local AutoPlaceRebirthEnabled = false
local AutoRebirthEnabled = false

-- States for Auto Fuse
local AutoFuseEnabled = false
local FuseSlots = {
    [1] = { Rarity = "Common", Mutation = "Normal" },
    [2] = { Rarity = "Common", Mutation = "Normal" },
    [3] = { Rarity = "Common", Mutation = "Normal" },
    [4] = { Rarity = "Common", Mutation = "Normal" }
}

local RarityPriority = {
    "Celestial", "Secret", "Godly", "Mythic", "Legendary", "Epic", "Rare", "Uncommon", "Common"
}
local MutationsList = {"Normal", "Gold", "Emerald", "Diamond", "Rainbow", "Bloodmoon"}

-- Suffix table for Auto Upgrade Plot
local suffixes = {
    k = 1e3, m = 1e6, b = 1e9, t = 1e12, 
    qd = 1e15, qn = 1e18, sx = 1e21, sp = 1e24, 
    oc = 1e27, no = 1e30, dc = 1e33
}

-- ==========================================
-- Helper Functions
-- ==========================================
local function getMyPlot()
    if not plotsFolder then return nil end
    
    -- Fetch Plot number from LocalPlayer's Attribute directly
    local plotNumber = player:GetAttribute("Plot")
    
    if plotNumber then
        local plotName = tostring(plotNumber)
        local targetPlot = plotsFolder:FindFirstChild(plotName)
        if targetPlot then
            return targetPlot
        end
    end
    
    -- Fallback
    for _, plot in pairs(plotsFolder:GetChildren()) do
        if plot:FindFirstChild(player.Name) or plot:FindFirstChild(player.DisplayName) then
            return plot
        end
    end
    
    return nil
end

local function checkMutation(obj)
    local attr = obj:GetAttribute("Mutation")
    local valObj = obj:FindFirstChild("Mutation")
    return attr or (valObj and valObj.Value) or "Normal"
end

local function safeParse(val)
    if not val then return 0 end
    local str = tostring(val):gsub("[%$,%s]", ""):lower()
    local oldMultipliers = {k=10^3, m=10^6, b=10^9, t=10^12, qd=10^15, qn=10^18, sx=10^21, sp=10^24, o=10^27}
    for suffix, mult in pairs(oldMultipliers) do
        if str:find(suffix) then
            local numStr = str:match("[%d%.]+")
            if tonumber(numStr) then return tonumber(numStr) * mult end
        end
    end
    return tonumber(str:match("[%d%.]+") or 0) or 0
end

local function parseToNumber(input)
    local text = tostring(input):gsub("[%,%$%s]", "")
    local numberPart = tonumber(string.match(text, "[%d%.]+"))
    local suffixPart = string.match(text, "%a+")
    
    if not numberPart then return 0 end
    if suffixPart then
        local multiplier = suffixes[suffixPart:lower()]
        if multiplier then
            return numberPart * multiplier
        end
    end
    return numberPart
end

local function findBestItemInBackpack()
    for _, rarityName in ipairs(RarityPriority) do
        if SelectedPlaceRarities[rarityName] then
            for _, item in pairs(player.Backpack:GetChildren()) do
                local mutation = item:GetAttribute("Mutation") or "Normal"
                if SelectedPlaceMutations[mutation] then
                    local rarityText = ""
                    local success = pcall(function()
                        rarityText = item.Brainrot.RootPart.BrainrotAtt.BillboardGui.Rarity.Text
                    end)
                    if success and rarityText == rarityName then
                        return item
                    end
                end
            end
        end
    end
    return nil
end

local function getAvailablePlace(myPlot)
    local success, upgradeLabel = pcall(function() return myPlot.Upgrade.Main.SurfaceGui.Upgrade.Upgraded end)
    if not success or not upgradeLabel then return nil end
    
    local currentLevel = tonumber(string.match(upgradeLabel.Text, "%d+")) or 0
    local maxPlaces = currentLevel + 10 

    for i = 1, maxPlaces do
        local id = tostring(i)
        if not myPlot.Brainrots:FindFirstChild(id) and myPlot.Places:FindFirstChild(id) then
            return myPlot.Places[id]
        end
    end
    return nil
end

local function checkAndUpgradePlot()
    if not AutoUpgradePlotEnabled then return end
    local myPlot = getMyPlot()
    if not myPlot then return end

    local cashObj = player:FindFirstChild("leaderstats") and player.leaderstats:FindFirstChild("Cash")
    if not cashObj then return end
    local myCash = parseToNumber(cashObj.Value)

    local successLabel, priceLabel = pcall(function() return myPlot.Upgrade.Main.SurfaceGui.Upgrade.Price end)
    if not successLabel or not priceLabel then return end
    
    local upgradePrice = parseToNumber(priceLabel.Text)

    if myCash >= upgradePrice and upgradePrice > 0 then
        pcall(function() upgradeEvent:InvokeServer() end)
    end
end

local function processAutoSell()
    if not AutoSellEnabled then return end
    local backpack = player:FindFirstChild("Backpack")
    if not backpack then return end

    for _, item in pairs(backpack:GetChildren()) do
        if not AutoSellEnabled then break end
        
        local mutation = item:GetAttribute("Mutation") or "Normal"
        
        if SelectedSellMutations[mutation] then
            local rarityText = ""
            local success = pcall(function()
                rarityText = item.Brainrot.RootPart.BrainrotAtt.BillboardGui.Rarity.Text
            end)

            if success and SelectedSellRarities[rarityText] then
                if player.Character and player.Character:FindFirstChildOfClass("Humanoid") then
                    player.Character.Humanoid:UnequipTools()
                    task.wait(0.1)
                    
                    if not AutoSellEnabled then break end
                    
                    item.Parent = player.Character
                    task.wait(0.2)
                    
                    if not AutoSellEnabled then break end
                    
                    pcall(function()
                        sellEvent:InvokeServer("SellOne")
                    end)
                    
                    task.wait(0.3)
                end
            end
        end
    end
end

-- Helper Functions for Rebirth
local function getRebirthTargetName()
    local success, targetName = pcall(function()
        local worldModel = player.PlayerGui.HUD.Rebirth.InsiderFrame.Insider.Brainrots.RebirthReward.ViewportFrame.WorldModel
        local firstObj = worldModel:FindFirstChildOfClass("Model") or worldModel:GetChildren()[1]
        return firstObj and firstObj.Name or nil
    end)
    return success and targetName or nil
end

local function checkTargetInPlot(targetName)
    if not targetName then return false end
    local myPlot = getMyPlot()
    if myPlot and myPlot:FindFirstChild("Brainrots") then
        for _, obj in pairs(myPlot.Brainrots:GetChildren()) do
            if obj.Name == targetName or obj:GetAttribute("Name") == targetName then return true end
            if obj:FindFirstChild(targetName, true) then return true end
            local success, title = pcall(function() return obj.RootPart.BrainrotAtt.BillboardGui.Title.Text end)
            if success and title == targetName then return true end
        end
    end
    return false
end

-- Helper Function for finding items for FuseMachine
local function findItemsForFuse()
    local backpack = player:FindFirstChild("Backpack")
    if not backpack then return nil end

    local foundUUIDs = {}
    local usedUUIDs = {}

    for slotNum = 1, 4 do
        local targetRarity = FuseSlots[slotNum].Rarity
        local targetMutation = FuseSlots[slotNum].Mutation
        local foundForThisSlot = false

        for _, item in pairs(backpack:GetChildren()) do
            if item.Name == "Bat" then continue end
            
            local uuid = item:GetAttribute("UUID")
            if not uuid or usedUUIDs[uuid] then continue end

            local mutation = item:GetAttribute("Mutation") or "Normal"
            local rarityText = ""
            pcall(function() rarityText = item.Brainrot.RootPart.BrainrotAtt.BillboardGui.Rarity.Text end)

            if mutation == targetMutation and rarityText == targetRarity then
                foundUUIDs[slotNum] = uuid
                usedUUIDs[uuid] = true
                foundForThisSlot = true
                break
            end
        end

        if not foundForThisSlot then
            return nil
        end
    end

    return foundUUIDs 
end

-- ==========================================
-- Logic Loops
-- ==========================================

-- Combined Loop: Place (Priority) & Collect
task.spawn(function()
    while task.wait(0.5) do
        local myPlot = getMyPlot()
        
        if AutoPlaceEnabled and myPlot then
            local itemToPlace = findBestItemInBackpack()
            local placeSlot = getAvailablePlace(myPlot)
            
            if itemToPlace and placeSlot then
                if player.Character and player.Character:FindFirstChildOfClass("Humanoid") then
                    player.Character.Humanoid:UnequipTools()
                    task.wait(0.2)
                end
                
                itemToPlace.Parent = player.Character
                local hrp = player.Character:FindFirstChild("HumanoidRootPart")
                if hrp then
                    local targetCFrame = placeSlot:IsA("Model") and placeSlot:GetPivot() or placeSlot.CFrame
                    hrp.CFrame = targetCFrame * CFrame.new(0, 3, 0)
                    hrp.Anchored = true
                    task.wait(1)
                    hrp.Anchored = false
                    vim:SendKeyEvent(true, Enum.KeyCode.E, false, game)
                    task.wait(3.5)
                    vim:SendKeyEvent(false, Enum.KeyCode.E, false, game)
                    
                end
                continue
            end
        end

        if AutoCollectEnabled and brainrotsFolder then
            local targetObj = nil
            for _, rarityName in ipairs(RarityPriority) do
                if SelectedCollectRarities[rarityName] then
                    local folder = brainrotsFolder:FindFirstChild(rarityName)
                    if folder then
                        for _, obj in pairs(folder:GetChildren()) do
                            local currentMutation = checkMutation(obj)
                            if SelectedCollectMutations[currentMutation] then
                                targetObj = obj
                                break
                            end
                        end
                    end
                end
                if targetObj then break end
            end

            if targetObj and player.Character and player.Character:FindFirstChild("HumanoidRootPart") then
                local hrp = player.Character.HumanoidRootPart
                local returnPoint = myPlot and myPlot:GetPivot() or hrp.CFrame
                local targetCFrame = targetObj:IsA("Model") and targetObj:GetPivot() or targetObj.CFrame
                
                local collectPos = targetCFrame * CFrame.new(0, 0, 2.5)
                hrp.CFrame = collectPos
                task.wait(0.2)
                
                vim:SendKeyEvent(true, Enum.KeyCode.E, false, game)
                local startTime = tick()
                while tick() - startTime < 2.8 do
                    if not targetObj or not targetObj.Parent then break end
                    hrp.CFrame = collectPos
                    task.wait(0.01)
                end
                vim:SendKeyEvent(false, Enum.KeyCode.E, false, game)
                task.wait(0.1)
                hrp.CFrame = returnPoint
            end
        end
    end
end)

-- Auto Sell Loop
task.spawn(function()
    while task.wait(0.5) do
        pcall(processAutoSell)
    end
end)

-- Auto Claim
task.spawn(function()
    while true do
        if AutoClaimEnabled then
            local char = player.Character
            local plot = getMyPlot()
            if char and char:FindFirstChild("HumanoidRootPart") and plot then
                local places = plot:FindFirstChild("Places")
                if places then
                    for _, sub in pairs(places:GetChildren()) do
                        local btn = sub:FindFirstChild("Claim")
                        if btn and btn:IsA("BasePart") then
                            firetouchinterest(char.HumanoidRootPart, btn, 0)
                            task.wait(0.01)
                            firetouchinterest(char.HumanoidRootPart, btn, 1)
                        end
                    end
                end
            end
        end
        task.wait(ClaimDelay)
    end
end)

-- Auto Upgrade Brainrot
task.spawn(function()
    while true do
        if AutoUpgradeBrainrotEnabled then
            local myPlot = getMyPlot()
            local leaderstats = player:FindFirstChild("leaderstats")
            local cashObj = leaderstats and (leaderstats:FindFirstChild("Cash") or leaderstats:FindFirstChild("Money"))
            local remote = ReplicatedStorage:FindFirstChild("Events") and ReplicatedStorage.Events:FindFirstChild("Upgrade")
            
            if myPlot and cashObj and remote then
                local myCash = safeParse(cashObj.Value)
                local places = myPlot:FindFirstChild("Places")
                
                if places then
                    for _, sub in pairs(places:GetChildren()) do
                        local priceLabel = sub:FindFirstChild("Price", true)
                        if not priceLabel or not (priceLabel:IsA("TextLabel") or priceLabel:IsA("TextBox")) or priceLabel.Text == "" then
                            continue 
                        end
                        local price = safeParse(priceLabel.Text)
                        if price <= 0 or myCash < price then continue end
                        local upgradeId = tonumber(sub.Name)
                        if upgradeId then
                            pcall(function() remote:InvokeServer(upgradeId) end)
                            myCash = myCash - price 
                        end
                    end
                end
            end
        end
        task.wait(2)
    end
end)

-- Auto Upgrade Plot
task.spawn(function()
    while true do
        pcall(checkAndUpgradePlot)
        task.wait(2)
    end
end)

-- Auto Speed
task.spawn(function()
    while true do
        if AutoSpeedEnabled then
            local remote = ReplicatedStorage:FindFirstChild("Events") and ReplicatedStorage.Events:FindFirstChild("Speed")
            if remote then pcall(function() remote:InvokeServer("Speed", SpeedUpgradeAmount) end) end
        end
        task.wait(0.5)
    end
end)

-- Auto Collect Request
task.spawn(function()
    while task.wait(0.1) do
        if AutoCollectRequestEnabled then
            local targetName = getRebirthTargetName()
            if targetName and not checkTargetInPlot(targetName) then
                local hasInBackpack = player.Backpack:FindFirstChild(targetName) or (player.Character and player.Character:FindFirstChild(targetName))
                
                if not hasInBackpack then
                    local foundTarget = nil
                    if brainrotsFolder then
                        for _, rarityFolder in pairs(brainrotsFolder:GetChildren()) do
                            foundTarget = rarityFolder:FindFirstChild(targetName)
                            if foundTarget then break end
                        end
                    end
                    
                    if foundTarget and player.Character and player.Character:FindFirstChild("HumanoidRootPart") then
                        local hrp = player.Character.HumanoidRootPart
                        local myPlot = getMyPlot()
                        local returnPoint = myPlot and myPlot:GetPivot() or hrp.CFrame
                        local targetCFrame = foundTarget:IsA("Model") and foundTarget:GetPivot() or foundTarget.CFrame
                        
                        local collectPos = targetCFrame * CFrame.new(0, 0, 2.5)
                        hrp.CFrame = collectPos
                        task.wait(0.2)
                        
                        vim:SendKeyEvent(true, Enum.KeyCode.E, false, game)
                        local startTime = tick()
                        while tick() - startTime < 2.8 do
                            if not foundTarget or not foundTarget.Parent then break end
                            hrp.CFrame = collectPos
                            task.wait(0.01)
                        end
                        vim:SendKeyEvent(false, Enum.KeyCode.E, false, game)
                        task.wait(0.1)
                        hrp.CFrame = returnPoint
                    end
                end
            end
        end
    end
end)

-- Auto Place Brainrot Rebirth
task.spawn(function()
    while task.wait(1) do
        if AutoPlaceRebirthEnabled then
            local targetName = getRebirthTargetName()
            if targetName and not checkTargetInPlot(targetName) then
                local itemToPlace = player.Backpack:FindFirstChild(targetName)
                if itemToPlace then
                    local myPlot = getMyPlot()
                    local placeSlot = myPlot and getAvailablePlace(myPlot) or nil
                    
                    if placeSlot and player.Character and player.Character:FindFirstChild("HumanoidRootPart") then
                        player.Character.Humanoid:UnequipTools()
                        task.wait(0.2)
                        itemToPlace.Parent = player.Character
                        
                        local hrp = player.Character.HumanoidRootPart
                        local targetCFrame = placeSlot:IsA("Model") and placeSlot:GetPivot() or placeSlot.CFrame
                        hrp.CFrame = targetCFrame * CFrame.new(0, 3, 0)
                        hrp.Anchored = true
                        task.wait(1)
                        hrp.Anchored = false
                        vim:SendKeyEvent(true, Enum.KeyCode.E, false, game)
                        task.wait(3.5)
                        vim:SendKeyEvent(false, Enum.KeyCode.E, false, game)
                    end
                end
            end
        end
    end
end)

-- Auto Rebirth + Clear Notifications
local notificationConnection = nil
task.spawn(function()
    while task.wait(1) do
        if AutoRebirthEnabled then
            pcall(function()
                local notifications = player.PlayerGui.HUD.Notifications
                if notifications then
                    for _, child in pairs(notifications:GetChildren()) do
                        if not child:IsA("UIListLayout") and not child:IsA("UIPadding") then
                            child:Destroy()
                        end
                    end
                    
                    if not notificationConnection then
                        notificationConnection = notifications.ChildAdded:Connect(function(child)
                            if AutoRebirthEnabled then
                                if not child:IsA("UIListLayout") and not child:IsA("UIPadding") then
                                    child:Destroy()
                                end
                            end
                        end)
                    end
                end
            end)

            pcall(function()
                local args = { "Rebirth" }
                ReplicatedStorage:WaitForChild("Events"):WaitForChild("Rebirth"):InvokeServer(unpack(args))
            end)
        else
            if notificationConnection then
                notificationConnection:Disconnect()
                notificationConnection = nil
            end
        end
    end
end)

-- Auto Fuse Loop
-- Auto Fuse Loop
task.spawn(function()
    while task.wait(1) do
        if AutoFuseEnabled then
            local fuseMachine = workspace:FindFirstChild("GameFolder") and workspace.GameFolder:FindFirstChild("FuseMachine")
            
            -- [FIX 1] à¹à¸à¹‰à¹„à¸‚ Path à¸›à¹‰à¸²à¸¢à¹ƒà¸«à¹‰à¸£à¸­à¸‡à¸£à¸±à¸š Frame à¸—à¸µà¹ˆà¸„à¸±à¹ˆà¸™à¸­à¸¢à¸¹à¹ˆà¸•à¸£à¸‡à¸à¸¥à¸²à¸‡ (à¹ƒà¸Šà¹‰ true à¹€à¸žà¸·à¹ˆà¸­à¸„à¹‰à¸™à¸«à¸²à¸—à¸°à¸¥à¸¸à¹‚à¸Ÿà¸¥à¹€à¸”à¸­à¸£à¹Œ)
            local timerDisplay = fuseMachine and fuseMachine:FindFirstChild("TimerDisplay") and fuseMachine.TimerDisplay:FindFirstChild("Display", true)
            
            local remotes = ReplicatedStorage:FindFirstChild("Remotes") and ReplicatedStorage.Remotes:FindFirstChild("FuseMachine")
            local placeRemote = remotes and remotes:FindFirstChild("PlaceBrainrot")
            local startRemote = remotes and remotes:FindFirstChild("StartFuse")
            local collectRemote = remotes and remotes:FindFirstChild("CollectResult")

            if placeRemote and startRemote and collectRemote and timerDisplay then
                
                -- Check if there are completed items remaining
                local initialTimeText = ""
                pcall(function() initialTimeText = timerDisplay.Text:lower() end)
                
                if string.find(initialTimeText, "ready") or string.find(initialTimeText, "collect") or string.find(initialTimeText, "done") or initialTimeText == "0s" then
                    print("âœ¨ Found completed Fuse items (Ready!). Collecting before restarting...")
                    pcall(function() collectRemote:FireServer() end)
                    task.wait(1.5)
                end

                if not AutoFuseEnabled then continue end

                local fuseItems = findItemsForFuse()
                
                if fuseItems then
                    print("âš™ï¸ Found all 4 items! Placing into Fuse Machine...")
                    
                    -- Place items in 4 slots
                    for i = 1, 4 do
                        if not AutoFuseEnabled then break end
                        local uuid = fuseItems[i]
                        pcall(function() placeRemote:FireServer(tostring(i), uuid) end)
                        task.wait(1)
                    end
                    
                    if not AutoFuseEnabled then continue end
                    
                    -- Press Start Fuse
                    print("â–¶ï¸ Starting fusion (Start Fuse)...")
                    pcall(function() startRemote:FireServer() end)
                    task.wait(1)
                    
                    -- Read the display to check completion time
                    print("â³ Waiting for Fuse... (Reading time from display)")
                    while AutoFuseEnabled do
                        local timeText = ""
                        pcall(function() timeText = timerDisplay.Text:lower() end)
                        
                        local hasNumber = string.match(timeText, "%d+")
                        if not hasNumber or timeText == "0s" or string.find(timeText, "ready") or string.find(timeText, "collect") or string.find(timeText, "done") then
                            break
                        end
                        task.wait(1)
                    end
                    
                    if not AutoFuseEnabled then continue end
                    
                    -- Press Collect when fusion is done
                    print("âœ… Fuse completed! Collecting items...")
                    pcall(function() collectRemote:FireServer() end)
                    task.wait(1)
                    
                    -- Teleport back to own Plot
                    local myPlot = getMyPlot()
                    if myPlot and player.Character and player.Character:FindFirstChild("HumanoidRootPart") then
                        print("ðŸ  Teleporting back to Plot...")
                        local hrp = player.Character.HumanoidRootPart
                        local targetPos = myPlot:IsA("Model") and myPlot:GetPivot() or myPlot.CFrame
                        
                        if myPlot:FindFirstChild("YourBaseAtt") then
                            targetPos = myPlot.YourBaseAtt.CFrame
                        elseif myPlot:FindFirstChild("Base") then
                            targetPos = myPlot.Base.CFrame
                        end
                        
                        hrp.CFrame = targetPos * CFrame.new(0, 5, 0)
                    end
                    
                    task.wait(2)
                else
                    -- [FIX 2] à¹€à¸žà¸´à¹ˆà¸¡à¹à¸ˆà¹‰à¸‡à¹€à¸•à¸·à¸­à¸™à¹€à¸§à¸¥à¸²à¸‚à¸­à¸‡à¹„à¸¡à¹ˆà¸„à¸£à¸š à¸ˆà¸°à¹„à¸”à¹‰à¹„à¸¡à¹ˆà¸‡à¸‡à¸§à¹ˆà¸²à¸—à¸³à¹„à¸¡à¸¡à¸±à¸™à¹€à¸‡à¸µà¸¢à¸š
                    warn("â³ Waiting for matching Brainrots... (Make sure you have exactly 4 items that match your UI settings in your Backpack)")
                end
            else
                warn("âŒ Remote or TimerDisplay not found! Try moving closer to the Fuse Machine")
                task.wait(3)
            end
        end
    end
end)

-- ==========================================
-- UI Elements
-- ==========================================

-- Main Tab
Tabs.Main:AddToggle("AutoClaimToggle", { Title = "Auto Claim Money", Default = false, Callback = function(v) AutoClaimEnabled = v end })
Tabs.Main:AddSlider("ClaimDelay", { Title = "Claim Delay", Default = 0.5, Min = 0.5, Max = 2, Rounding = 1, Callback = function(v) ClaimDelay = v end })
Tabs.Main:AddToggle("AutoUpgradePlotToggle", { Title = "Auto Upgrade Plot", Default = false, Callback = function(v) AutoUpgradePlotEnabled = v end })
Tabs.Main:AddToggle("AutoUpgradeBrainrotToggle", { Title = "Auto Upgrade Brainrot", Default = false, Callback = function(v) AutoUpgradeBrainrotEnabled = v end })
Tabs.Main:AddToggle("AutoSpeedToggle", { Title = "Auto Upgrade Speed", Default = false, Callback = function(v) AutoSpeedEnabled = v end })
Tabs.Main:AddDropdown("SpeedAmount", { Title = "Speed Amount", Values = {1, 5, 10}, Default = 10, Callback = function(v) SpeedUpgradeAmount = tonumber(v) end })

-- Brainrot Tab
Tabs.Brainrot:AddToggle("AutoCollectToggle", { Title = "Enable Auto Collect", Default = false, Callback = function(v) AutoCollectEnabled = v end })
Tabs.Brainrot:AddDropdown("CollectMutationSelect", { Title = "Collect Mutations", Values = MutationsList, Multi = true, Default = {"Normal"}, Callback = function(v) SelectedCollectMutations = v end })
Tabs.Brainrot:AddDropdown("CollectRaritySelect", { Title = "Collect Rarities", Values = RarityPriority, Multi = true, Default = {"Common"}, Callback = function(v) SelectedCollectRarities = v end })
Tabs.Brainrot:AddToggle("RemoveLavaToggle", { Title = "Remove All Lava", Default = false, Callback = function(v) if v and gameFolder and gameFolder:FindFirstChild("Lavas") then gameFolder.Lavas:Destroy() end end })
Tabs.Brainrot:AddToggle("RemoveVIPToggle", { Title = "Remove VIP Doors", Default = false, Callback = function(v) if v and gameFolder and gameFolder:FindFirstChild("VIPDoors") then gameFolder.VIPDoors:Destroy() end end })

-- Place Tab
Tabs.Place:AddToggle("AutoPlaceToggle", { Title = "Enable Auto Place", Default = false, Callback = function(v) AutoPlaceEnabled = v end })
Tabs.Place:AddDropdown("PlaceMutationSelect", { Title = "Place Mutations", Values = MutationsList, Multi = true, Default = {"Normal"}, Callback = function(v) SelectedPlaceMutations = v end })
Tabs.Place:AddDropdown("PlaceRaritySelect", { Title = "Place Rarities", Values = RarityPriority, Multi = true, Default = {"Common"}, Callback = function(v) SelectedPlaceRarities = v end })

-- Sell Tab
Tabs.Sell:AddToggle("AutoSellToggle", { Title = "Enable Auto Sell", Default = false, Callback = function(v) AutoSellEnabled = v end })
Tabs.Sell:AddDropdown("SellMutationSelect", { Title = "Sell Mutations", Values = MutationsList, Multi = true, Default = {"Normal"}, Callback = function(v) SelectedSellMutations = v end })
Tabs.Sell:AddDropdown("SellRaritySelect", { Title = "Sell Rarities", Values = RarityPriority, Multi = true, Default = {"Common"}, Callback = function(v) SelectedSellRarities = v end })

-- FuseMachine Tab
Tabs.FuseMachine:AddButton({ 
    Title = "Teleport to Fuse Machine", 
    Callback = function()
        local char = player.Character
        if char and char:FindFirstChild("HumanoidRootPart") then
            local fuseMachine = workspace:FindFirstChild("GameFolder") and workspace.GameFolder:FindFirstChild("FuseMachine")
            if fuseMachine then
                local targetCFrame = fuseMachine:IsA("Model") and fuseMachine:GetPivot() or fuseMachine.CFrame
                char.HumanoidRootPart.CFrame = targetCFrame * CFrame.new(0, 5, 10) -- Stand in front of the machine
            else
                Fluent:Notify({Title = "Error", Content = "Fuse Machine not found!", Duration = 3})
            end
        end
    end 
})
Tabs.FuseMachine:AddToggle("AutoFuseToggle", { Title = "Enable Auto Fuse", Default = false, Callback = function(v) AutoFuseEnabled = v end })
for i = 1, 4 do
    Tabs.FuseMachine:AddSection("ðŸŽ¯ Config Slot " .. i)
    Tabs.FuseMachine:AddDropdown("FuseRaritySlot"..i, {
        Title = "Rarity Slot " .. i,
        Values = RarityPriority,
        Multi = false,
        Default = "Common",
        Callback = function(v) FuseSlots[i].Rarity = v end
    })
    Tabs.FuseMachine:AddDropdown("FuseMutationSlot"..i, {
        Title = "Mutation Slot " .. i,
        Values = MutationsList,
        Multi = false,
        Default = "Normal",
        Callback = function(v) FuseSlots[i].Mutation = v end
    })
end

-- Rebirth Tab
Tabs.Rebirth:AddToggle("AutoCollectRequestToggle", { Title = "Auto Collect Request", Default = false, Callback = function(v) AutoCollectRequestEnabled = v end })
Tabs.Rebirth:AddToggle("AutoPlaceRebirthToggle", { Title = "Auto Place Rebirth", Default = false, Callback = function(v) AutoPlaceRebirthEnabled = v end })
Tabs.Rebirth:AddToggle("AutoRebirthToggle", { Title = "Auto Rebirth", Default = false, Callback = function(v) AutoRebirthEnabled = v end })


if raritiesFolder then
    for _, zone in pairs(raritiesFolder:GetChildren()) do
        Tabs.Teleport:AddButton({ Title = "Go to " .. zone.Name, Callback = function()
            local char = player.Character
            if char and char:FindFirstChild("HumanoidRootPart") then
                local target = zone:IsA("Model") and (zone.PrimaryPart or zone:FindFirstChildWhichIsA("BasePart", true)) or zone
                if target then char.HumanoidRootPart.CFrame = target.CFrame * CFrame.new(0, 10, 0) end
            end
        end })
    end
end

-- Discord Tab
local DiscordSection = Tabs.Discord:AddSection("Join Our Community")
DiscordSection:AddButton({
    Title = "Copy Discord Link",
    Description = "Click to copy the link to the clipboard.",
    Callback = function()
        if setclipboard then
            setclipboard("https://discord.gg/k2wdyy8QMN")
            Fluent:Notify({Title = "Discord", Content = "Link successfully copied.! (Copied to clipboard)", Duration = 3})
        else
            Fluent:Notify({Title = "Error", Content = "Your runner does not support copying links.", Duration = 3})
        end
    end
})

-- ==========================================
-- Settings System
-- ==========================================
SaveManager:SetLibrary(Fluent)
InterfaceManager:SetLibrary(Fluent)
InterfaceManager:SetFolder("MoMoHub")
SaveManager:SetFolder("MomoHub/Configs")
InterfaceManager:BuildInterfaceSection(Tabs.Settings)
SaveManager:BuildConfigSection(Tabs.Settings)
Window:SelectTab(1)
SaveManager:LoadAutoloadConfig()

-- ==========================================
-- Floating UI Toggle System (Mobile Support)
-- ==========================================
local CoreGui = game:GetService("CoreGui")
local UserInputService = game:GetService("UserInputService")
local VirtualInputManager = game:GetService("VirtualInputManager")

local ScreenGui = Instance.new("ScreenGui")
ScreenGui.Name = "HubMobileToggle"
ScreenGui.ResetOnSpawn = false
local success, _ = pcall(function() ScreenGui.Parent = CoreGui end)
if not success then ScreenGui.Parent = game.Players.LocalPlayer:WaitForChild("PlayerGui") end

local ToggleBtn = Instance.new("ImageButton")
ToggleBtn.Name = "ToggleBtn"
ToggleBtn.Parent = ScreenGui
ToggleBtn.BackgroundTransparency = 1 
ToggleBtn.Position = UDim2.new(0.5, -30, 0.1, 0) 
ToggleBtn.Size = UDim2.new(0, 60, 0, 60) 
ToggleBtn.Image = "rbxthumb://type=Asset&id=82100122245666&w=150&h=150" -- M logo

local dragging = false
local dragStart = nil
local startPos = nil
local clickTime = 0

ToggleBtn.InputBegan:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
        dragging = true
        dragStart = input.Position
        startPos = ToggleBtn.Position
        clickTime = tick() 
    end
end)

ToggleBtn.InputEnded:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
        dragging = false
        if tick() - clickTime < 0.2 then
            VirtualInputManager:SendKeyEvent(true, Enum.KeyCode.LeftControl, false, game)
            task.wait(0.05)
            VirtualInputManager:SendKeyEvent(false, Enum.KeyCode.LeftControl, false, game)
        end
    end
end)

UserInputService.InputChanged:Connect(function(input)
    if dragging and (input.UserInputType == Enum.UserInputType.MouseMovement or input.UserInputType == Enum.UserInputType.Touch) then
        local delta = input.Position - dragStart
        ToggleBtn.Position = UDim2.new(startPos.X.Scale, startPos.X.Offset + delta.X, startPos.Y.Scale, startPos.Y.Offset + delta.Y)
    end
end)
